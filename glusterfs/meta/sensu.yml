{%- from "glusterfs/map.jinja" import server with context -%}
{%- if pillar.glusterfs.server is defined %}
check:
{%- for volume_name, volume in server.get('volumes', {}).iteritems() %}
  local_glusterfs_volume_{{ volume_name }}_{{ grains['fqdn'] }}:
    command: "PATH=$PATH:/etc/sensu/plugins check_glusterfs -v {{ volume_name }} -n {{ volume.bricks|length }} -w 5 -c 1"
    {%- set interval=320+(loop.index*5) %}
    interval: {{ interval }}
    timeout: 120
    occurrences: 1
    subscribers:
    - {{ grains['fqdn']|replace('.', '-') }}
{%- endfor %}
{%- endif %}
