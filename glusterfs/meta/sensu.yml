{%- from "linux/map.jinja" import network with context -%}
{%- from "glusterfs/map.jinja" import server with context -%}
{%- if pillar.glusterfs.server is defined %}
check:
{%- for volume_name, volume in server.get('volumes', {}).iteritems() %}
  local_glusterfs_status_{{ volume_name }}_{{ network.fqdn }}:
    command: "PATH=$PATH:/etc/sensu/plugins check_glusterfs -v {{ volume_name }} -n {{ volume.bricks|length }} -w 5 -c 1"
    {%- set interval=120+(loop.index*5)+range(1,60)|random %}
    interval: {{ interval }}
    occurrences: 3
    subscribers:
    - local-glusterfs-server
{%- endfor %}
{%- endif %}
